@model Student_Portal.ViewModels.StudentFormViewModel
@{
    ViewData["Title"] = Model.Id == 0 ? "New Form" : "Edit Form";
}

<div class="container">
    <h2>@ViewData["Title"]</h2>

    @if (Model.IsSubmitted)
    {
        <div class="alert alert-warning">
            <strong>Note:</strong> This form has been submitted. You cannot make further changes.
        </div>
        return;
    }

    <form method="post" enctype="multipart/form-data">
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="UploadedDocumentBase64" />
        
        <div class="form-group">
            <label asp-for="MatricNumber"></label>
            <input asp-for="MatricNumber" class="form-control" />
            <span asp-validation-for="MatricNumber" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="Department"></label>
            <input asp-for="Department" class="form-control" />
            <span asp-validation-for="Department" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="Level"></label>
            <select asp-for="Level" class="form-control">
                <option value="">Select Level</option>
                <option value="100">100 Level</option>
                <option value="200">200 Level</option>
                <option value="300">300 Level</option>
                <option value="400">400 Level</option>
            </select>
            <span asp-validation-for="Level" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="JambRegNumber"></label>
            <input asp-for="JambRegNumber" class="form-control" />
            <span asp-validation-for="JambRegNumber" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="WAECRegNumber"></label>
            <input asp-for="WAECRegNumber" class="form-control" />
            <span asp-validation-for="WAECRegNumber" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="ModeOfEntry"></label>
            <select asp-for="ModeOfEntry" class="form-control" asp-items="Html.GetEnumSelectList<ModeOfEntry>()">
                <option value="">-- Select Mode of Entry --</option>
            </select>
            <span asp-validation-for="ModeOfEntry" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="MaritalStatus"></label>
            <select asp-for="MaritalStatus" class="form-control" asp-items="Html.GetEnumSelectList<MaritalStatus>()">
                <option value="">-- Select Marital Status --</option>
            </select>
            <span asp-validation-for="MaritalStatus" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="PostUtmeScore"></label>
            <input asp-for="PostUtmeScore" class="form-control" />
            <span asp-validation-for="PostUtmeScore" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="JambScore"></label>
            <input asp-for="JambScore" class="form-control" />
            <span asp-validation-for="JambScore" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="DateOfBirth"></label>
            <input asp-for="DateOfBirth"
                   class="form-control"
                   type="date"
                   min="1960-01-01"
                   max="@DateTime.Now.AddYears(-15).ToString("yyyy-MM-dd")" />
            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="Nationality"></label>
            <select asp-for="Nationality" class="form-control">
                <option value="">Select Nationality</option>
                <option value="Nigeria">Nigeria</option>
            </select>
            <span asp-validation-for="Nationality" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="State"></label>
            <input asp-for="State" class="form-control" />
            <span asp-validation-for="State" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="LocalGov"></label>
            <input asp-for="LocalGov" class="form-control" />
            <span asp-validation-for="LocalGov" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="NextOfKin"></label>
            <input asp-for="NextOfKin" class="form-control" />
            <span asp-validation-for="NextOfKin" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="NextOfKinPhoneNumber"></label>
            <input asp-for="NextOfKinPhoneNumber" class="form-control" />
            <span asp-validation-for="NextOfKinPhoneNumber" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label>Upload Document</label>
            <input type="file" name="document" class="form-control" accept=".pdf,.doc,.docx" />
            @if (!string.IsNullOrEmpty(Model.UploadedDocumentBase64))
            {
                <div class="mt-2">
                    <a href="data:application/pdf;base64,@Model.UploadedDocumentBase64" 
                       target="_blank" class="btn btn-sm btn-info">
                        View Current Document
                    </a>
                </div>
            }
        </div>

        <div class="form-group mt-4">
            <div class="custom-control custom-checkbox">
                <input type="checkbox" asp-for="IsSubmitted" class="custom-control-input" id="finalSubmit" />
                <label class="custom-control-label" for="finalSubmit">
                    I confirm that all information is correct and I want to submit this form
                </label>
            </div>
        </div>

        <div class="form-group mt-4">
            <button type="submit" class="btn btn-primary">Save</button>
            @if (!string.IsNullOrEmpty(Model.UploadedDocumentBase64))
            {
                <button type="submit" name="IsSubmitted" value="true" class="btn btn-success">
                    Submit Form
                </button>
            }
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.getElementById('finalSubmit').addEventListener('change', function() {
            if (this.checked) {
                if (!confirm('Are you sure you want to submit the form? You won\'t be able to make changes after submission.')) {
                    this.checked = false;
                }
            }
        });
    </script>
}